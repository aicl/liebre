<!DOCTYPE html>
<html>
<head>
    <title>${Title}</title>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="description" content="Diagnostico SGSST, Decreto 1443 de 2014, OHSAS, RUC">
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0"/>
    <style>
        .center { margin-left: auto;    margin-right: auto;    width: 95%;  }

		div[red]{
			background:#d23f31;
			color:#fff
		}
		div[green]{
			background:#259b24;
			color:#fff
		}
		button[fab]{
			display: inline-block;
			position: relative;
			outline: none;
			-webkit-user-select: none;
			user-select: none;
			cursor: pointer;
			z-index: 0;
			box-sizing: border-box;
			width: 56px;
			height: 56px;
			border-radius: 50%;
			font-size:medium;
			border:0px;
		}
		button[fab][red]{
			background:#d23f31;
			color:#fff
		}
		button[fab][green]{
			background:#259b24;
			color:#fff
		}
		.no{
		background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAIhSURBVDjLlZPrThNRFIWJicmJz6BWiYbIkYDEG0JbBiitDQgm0PuFXqSAtKXtpE2hNuoPTXwSnwtExd6w0pl2OtPlrphKLSXhx07OZM769qy19wwAGLhM1ddC184+d18QMzoq3lfsD3LZ7Y3XbE5DL6Atzuyilc5Ciyd7IHVfgNcDYTQ2tvDr5crn6uLSvX+Av2Lk36FFpSVENDe3OxDZu8apO5rROJDLo30+Nlvj5RnTlVNAKs1aCVFr7b4BPn6Cls21AWgEQlz2+Dl1h7IdA+i97A/geP65WhbmrnZZ0GIJpr6OqZqYAd5/gJpKox4Mg7pD2YoC2b0/54rJQuJZdm6Izcgma4TW1WZ0h+y8BfbyJMwBmSxkjw+VObNanp5h/adwGhaTXF4NWbLj9gEONyCmUZmd10pGgf1/vwcgOT3tUQE0DdicwIod2EmSbwsKE1P8QoDkcHPJ5YESjgBJkYQpIEZ2KEB51Y6y3ojvY+P8XEDN7uKS0w0ltA7QGCWHCxSWWpwyaCeLy0BkA7UXyyg8fIzDoWHeBaDN4tQdSvAVdU1Aok+nsNTipIEVnkywo/FHatVkBoIhnFisOBoZxcGtQd4B0GYJNZsDSiAEadUBCkstPtN3Avs2Msa+Dt9XfxoFSNYF/Bh9gP0bOqHLAm2WUF1YQskwrVFYPWkf3h1iXwbvqGfFPSGW9Eah8HSS9fuZDnS32f71m8KFY7xs/QZyu6TH2+2+FAAAAABJRU5ErkJggg==");
		background-repeat: no-repeat;background-position: 50% 50%;
		}
		.alerta{
		background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABzElEQVQ4jaWSMWhUQRCGv0uueHazoJAHFrdC4J5Y3FuwiF22i+WlMmKhVwWDIFfZC4JEBDksRBvhpQgYQXhXJkXgtJBcYaGVm+5ZCLvlFiks3oWouQsRpxpm5v/5ZnbhP6Mxq1Htd7WrwveDjwcAauN5CNPm5mYZuCqUOrfYez2IFLPm5qcVR9u2K6m+n14zqGaFksZidtF/GH6KP85FIIkUqpXz7MkuGw8c4UKOStXwXCuM3tq+SlXy5uWYvNNFZ4bbd3bIO7IwWJfemQbVfldkQTalY3GHHnfo8JXHR4/ODCrl9ZkGzoVCaQOAzhTOOcbfxvRuGUCwK4bBuhRTDUbbVmutb0pLA2CXdU3gPasrGgiICCZXa4OHok8TREpp55Pck7chRIfJQFRdq8kAKI9l8wDlK2uvXs/7yeUrk8FA+OlRCUjawCxCchTgKBJjIMZ46UYr+TL8HL/OASihlLaZeAaI4Fxgdw92tuDde/fH4UwbSOrP1Sxf5H29ZJMa3UEE8GgNPjh8DKwua4ieQADqVUxG8viuFE3nwqYVDcFP/D3EgOApnipAnYijP8GIIAndRvFIjzwsKcDHv18ZwrHo994kF2HrtOIf4xf3L7IS97bhXgAAAABJRU5ErkJggg==");
		background-repeat: no-repeat;background-position: 50% 50%;
		}
		.si{
		background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAKfSURBVDjLpZPrS1NhHMf9O3bOdmwDCWREIYKEUHsVJBI7mg3FvCxL09290jZj2EyLMnJexkgpLbPUanNOberU5taUMnHZUULMvelCtWF0sW/n7MVMEiN64AsPD8/n83uucQDi/id/DBT4Dolypw/qsz0pTMbj/WHpiDgsdSUyUmeiPt2+V7SrIM+bSss8ySGdR4abQQv6lrui6VxsRonrGCS9VEjSQ9E7CtiqdOZ4UuTqnBHO1X7YXl6Daa4yGq7vWO1D40wVDtj4kWQbn94myPGkCDPdSesczE2sCZShwl8CzcwZ6NiUs6n2nYX99T1cnKqA2EKui6+TwphA5k4yqMayopU5mANV3lNQTBdCMVUA9VQh3GuDMHiVcLCS3J4jSLhCGmKCjBEx0xlshjXYhApfMZRP5CyYD+UkG08+xt+4wLVQZA1tzxthm2tEfD3JxARH7QkbD1ZuozaggdZbxK5kAIsf5qGaKMTY2lAU/rH5HW3PLsEwUYy+YCcERmIjJpDcpzb6l7th9KtQ69fi09ePUej9l7cx2DJbD7UrG3r3afQHOyCo+V3QQzE35pvQvnAZukk5zL5qRL59jsKbPzdheXoBZc4saFhBS6AO7V4zqCpiawuptwQG+UAa7Ct3UT0hh9p9EnXT5Vh6t4C22QaUDh6HwnECOmcO7K+6kW49DKqS2DrEZCtfuI+9GrNHg4fMHVSO5kE7nAPVkAxKBxcOzsajpS4Yh4ohUPPWKTUh3PaQEptIOr6BiJjcZXCwktaAGfrRIpwblqOV3YKdhfXOIvBLeREWpnd8ynsaSJoyESFphwTtfjN6X1jRO2+FxWtCWksqBApeiFIR9K6fiTpPiigDoadqCEag5YUFKl6Yrciw0VOlhOivv/Ff8wtn0KzlebrUYwAAAABJRU5ErkJggg==");
		background-repeat: no-repeat;background-position: 50% 50%;
		}
		/* tabla */
		.tb-min, .tb-header, .tb-s-header, .tb-one-col, .tb-rq
		{
			/*font-family: "Lucida Sans Unicode", "Lucida Grande", Sans-Serif;*/
			font-size: medium;
			background: #fff;
			width: 95%;
			border-collapse: collapse;
			text-align: left;
		}
		.tb-min th
		{
			font-size: medium;
			font-weight: normal;
			color: #039;
			padding: 0px 8px;
			border-bottom: 1px solid #6678b1;
			text-align:center;
		}
		.tb-min td
		{
			border-bottom: 1px solid #ccc;
			color: #669;
			padding: 4px 8px;
			text-align: justify;
		}

		table.tb-one-col > tr td:first-child{
			width: 100%;
		}

		table.tb-index {
			width: 90%;
		}

		table.tb-index tr td:first-child, table.tb-index tr th:first-child{
			width: 80%;
			font-size:x-large;
		}

		table.tb-index tr td:first-child+td{
			text-align:center;
		}

		.tb-cmp{	width:90%;}

		table.tb-cmp tr td:first-child+td+td+td, table.tb-cmp tr td:first-child+td+td+td+td{
			width:48%;
		}
		.tb-cmp td	{ padding: 4px 8px;}

		table.tb-s-header tr td:first-child, table.tb-s-header tr th:first-child{
			width: 20%;
		}

		table.tb-rq tr td:first-child{
			width: 10%;
		}
		table.tb-rq tr td:first-child+td{
			width: 70%;
		}

		table.tb-rq{	width:90%;}

		table.tb-rq td
		{
			border-bottom: 1px solid #ccc;
			color: #669;
			padding: 1px 4px;
			text-align: justify;
		}

		table.tb-claves{ width:80%};
		table.tb-claves tr td:first-child{
			width: 5%;
		}
		table.tb-claves tr td:first-child+td+td{
			width: 90%;
			padding-left:40px;
		}
		table.tb-claves tr td:first-child+td{
			width: 5%;

		}

		div.content, div.header, div.s-header{
			padding:0px 0px 0px 10px;
			width:auto;
		}
	    
	    .hbar {background-color: #259b24;color: #fff;text-align: center;padding: 2px;font-size: medium; border-radius:2px;}

	    [print-me]{
	    	display: none !important;
	    }

	    [hidden]{
	    	display: none !important;
	    }

div.cn {
  display: table-cell;
  width: 850px;
  height: 960px;
  vertical-align: middle;
  text-align: center;
}

div.inner {
  display: inline-block;
  width: 500px;
  text-align: left;
  color:white;
}

        @import "//ajax.googleapis.com/ajax/libs/dojo/1.10.2/dojo/resources/dojo.css";

    </style>
    <script type="text/javascript">
        var PhantomJSPrinting = {
            header: { height: "1.25cm", contents: function(pageNum, numPages) { 
            		return '<div '+ 
            		'style="margin: 0px -10px 2px -10px ; text-align: right; padding:10px 5px;font-size:small; background: #6b6b6b; color:'+(pageNum>1?'white;':'#6b6b6b;')+'">'+
  'Reporte de Cumplimiento Decreto 1443/2014 '+   
'</div>'+
'<div style="width:100%; height:4px; background:white;"></div>'; 
            	}
            }, 
            footer: { height: "1.1cm", contents: function(pageNum, numPages) {
                          //return "<span style='float:right'>" + pageNum + " / " + numPages + "</span>" 
                    return '<div style="width:100%; height:5px; background:white;"></div>'+ 
'<div '+ 
      'style="margin:0px -10px; text-align: right; padding:10px 5px;font-size:small; background: #3F832C; color:'+(pageNum>1?'white;':'#3F832C;')+'">'+
  pageNum + " / " + numPages +
'</div>';
                } 
            }
        };
        window.PhantomJSPrinting=PhantomJSPrinting;
    </script>
	<script src="//ajax.googleapis.com/ajax/libs/dojo/1.10.2/dojo/dojo.js" data-dojo-config="async: true"></script>
</head>
<body style="margin: 0px;"> 

	<div class="content" style="page-break-after: always;" >
    <div class="cn" print-me>
    <div class="inner" style="border-collapse:separate; border-spacing:0 5px;">
    	<div style="display:table-row;">
   			<div style="height:150px;background: rgb(182, 159, 99);color: white;font-size: xx-large;padding: 10px;border-radius: 8px;display: table-cell;vertical-align: middle;">Reporte de Cumplimiento Decreto 1443/2014</div>
   		</div>
		<div style="display:table-row;">
   			<div style="height:150px;background: #6b6b6b; color: white;font-size: xx-large;padding: 10px;border-radius: 8px;display: table-cell;vertical-align: middle;">Detalle de Resultados</div>
		</div>
		<div style="display:table-row;">
   			<div id="Empresa.Nombre" style="color:black; font-size: xx-large;padding: 10px;border-radius: 8px;"></div>
   		</div>
    </div></div></div>

	<div class="content" style="page-break-after: always;" >
	   <div class="center" style="text-align: center;">
	    <h3 no-print>Decreto 1443/2014</h3>
	    <h4>Cumplimiento Por Capítulos</h4>
		<table class="center tb-min tb-index" style="text-align: left;">
			<thead>
				<tr>
					<th>Capítulo</th>
					<th>Resultado</th>
				</tr>
			</thead>
			<tbody id="Indice"></tbody>
		</table>
		</div>
	</div>

	<div  class="content" style="margin-top:20px; page-break-after: always;">
		<div class="center" style="text-align: center;">
			<h3 no-print>Decreto 1443/2014</h3>
			<h4>Cumplimiento Por Capítulos</h4>
	    	<div id="spider" style="font-size: small; text-align: left;height: 550px; border-radius: 10px;border: 2px solid gray;	border-style: solid;background: #e7eef6;"></div>
	    	<!-- <span style='float:left'><div id="legend1"></div></span> !-->
	    </div>
	</div>

	<div no-print class="center" style="margin-top:20px; padding:20px; border-radius: 10px;border: 2px solid gray;	border-style: solid;background: #e7eef6;">
		<select id="NormaSelect" style="width:300px; height:30px;"></select>
	</div>

	<div class="content" style="margin-top:20px; page-break-after: always;">
		<div class="center" style="text-align: center;">
	    <h3>Aspectos Claves</h3>
	    <table class="center tb-min tb-claves">
			<thead>
				<tr>
					<th name="ArticuloNumeral" colspan="2"></th><th>Observación</th>
				</tr>
			</thead>
			<tbody id="Claves"></tbody>
		</table>
		</div>
	</div>

	<div class="content" style="margin-top:20px; page-break-after: always;">
	   <div class="center" style="text-align: center;">
	    <h3 id="TituloGrupos"></h3>
		<table class="center tb-min tb-rq">
			<thead>
				<tr>
					<th name="ArticuloNumeral"></th><th>Título</th><th>Resultado</th>
				</tr>
			</thead>
			<tbody id="IndiceRequisitos"></tbody>
		</table>
		</div>
	</div>

	<div class="content" style="margin-top:5px;" >
		<div class="center" style="text-align: center;">
	    	<h3 id="TituloDetalle"></h3>
			<div id="Cumplimiento" style="text-align: center;"></div>
			<div id="Nota" style="text-align: left;" ></div>
		</div>
	</div>
	<script>
		var mostrarNorma=function(data, norma, arrayUtil, lang){
			var htmlIndiceRequisitos="";
			var htmlCumplimiento="";
			var htmlClaves="";
			var claves=[];
			arrayUtil.forEach(norma.Grupos, function(grupo,i){
				// indice de grupos
				var valor= (grupo.TotalR/grupo.TotalQ)*100;
				var titulo= grupo.Titulo||'';
				var green = "#259b24";
				var red = (valor>=100)?"#259b24":"#d23f31";
                htmlIndiceRequisitos += 
                lang.replace("<tr><td>{grupo.Codigos}</td><td>{titulo}</td><td><div class='hbar' style='background-image: linear-gradient( to right, {green}, {green} {valor}%, {red} 0% ); background: -webkit-gradient(linear, left top, right top, color-stop({valor}%,{green}), color-stop({valor}%,{red}), color-stop({valor}%,{red}), color-stop({valor}%,{red}));'>{porc}%</div></td></tr>",
                {
                	titulo:titulo,
                	grupo:grupo,
                	valor:valor,
                	green:green,
                	red:red,
                	porc: valor.toFixed(0)
                });
				//tablas preguntas x grupo
				var preguntas=[];
				arrayUtil.forEach(grupo.Codigos, function(codigo){
					var pc= arrayUtil.filter(data.Preguntas, function(item){
						return grupo.Titulo? item.Pregunta[norma.Alias]===codigo:item.Pregunta.Numeral===codigo ;
					});
					preguntas= preguntas.concat(pc);
				});
				var filas="";
				var lis="";
				arrayUtil.forEach(preguntas, function(pregunta,j){
					var codigo = pregunta.Pregunta[norma.Alias]|| pregunta.Pregunta.Numeral;
					var respuesta= pregunta.Respuesta.Valor===1? 'si': 'no';
					var signo='';
					var li='';
					//   signo =  alera => respuesta=='no' y  ResumenNo
					//   li= ResumenSi /ResumenNo depediento de respuesta 
					if(respuesta==='si'){
					    if(pregunta.Pregunta.Clave){
					    	if(pregunta.Pregunta.ResumenSi) claves.push({respuesta:respuesta, codigo:codigo, observacion:pregunta.Pregunta.ResumenSi});
					    }
						if( pregunta.Pregunta.ResumenSi) li=  pregunta.Pregunta.ResumenSi;
					}
					else{
						if( pregunta.Pregunta.ResumenNo){
							signo='alerta';
						}

						if(pregunta.Pregunta.Clave){
					    	if(pregunta.Pregunta.ResumenNo) claves.push({respuesta:respuesta,codigo:codigo, observacion:pregunta.Pregunta.ResumenNo});
					    }
						if( pregunta.Pregunta.ResumenNo) li=  pregunta.Pregunta.ResumenNo;
					}
					if(li){
						lis+= '<li>'+ li + '</li>';
					}
					var comentario= pregunta.Respuesta.Valor===1? (pregunta.Pregunta.ComentarioSi)||'OK': (pregunta.Pregunta.ComentarioNo)||'Mal';
					var recomendacion= pregunta.Respuesta.Valor===1? (pregunta.Pregunta.RecomendacionSi)||'Continuar': (pregunta.Pregunta.RecomendacionNo)||'Resolver y Documentar';
					filas+=
					lang.replace('<tr><td class={signo}></td><td class={respuesta}></td><td>{codigo}</td><td>{comentario}</td><td>{recomendacion}</td></tr>',{
						respuesta:respuesta,
						comentario:comentario,
						recomendacion:recomendacion,
						codigo: codigo,
						signo:signo
					});
				});
                htmlCumplimiento += 
                lang.replace(
'<div style="height:1px;width:100%;"></div><table class="center tb-min tb-cmp" style="margin-top:10px; page-break-after: {pagebreak};">'+
	//'<thead>'+
		'<tr><th colspan="5">{titulo}</th></tr>'+
		'<tr><th colspan="3">{articuloNumeral}</th><th>Comentario</th><th>Recomendación</th></tr>'+
	//'</thead>'+
	'<tbody>{filas}'+
	'<tr><td colspan="4"><ul><span style="font-weight: bold;">{tituloLis}</span>{lis}</ul></td><td><div class="hbar center" style="width:50%;background-image: linear-gradient( to right, {green}, {green} {valor}%, {red} 0% ); background: -webkit-gradient(linear, left top, right top, color-stop({valor}%,{green}), color-stop({valor}%,{red}), color-stop({valor}%,{red}), color-stop({valor}%,{red}));">{porc}%</td></th>'+
'</tbody></table>',
                {
                	titulo:titulo,
                	grupo:grupo,
                	filas:filas,
                	articuloNumeral:norma.Titulo,
                	valor:valor,
                	green:green,
                	red:red,
                	tituloLis:lis?'Aspectos Claves':'',
                	lis :lis,
                	porc: valor.toFixed(0),
                	pagebreak: (norma.Grupos.length>i+1)?'always':'none'
                });
            });
            console.log(claves);
            for (var c in claves){
            	htmlClaves+= lang.replace('<tr><td class={clave.respuesta}></td><td>{clave.codigo}</td><td>{clave.observacion}</td></tr>',
            	{
					clave:claves[c]
				});
            }

			var an = document.querySelectorAll("[name=ArticuloNumeral]");
			for (var i =0; i<an.length;i++){
				an[i].innerHTML=norma.Titulo;
			}
            document.getElementById("TituloGrupos").innerHTML= norma.Alias!=="Decreto"? (norma.Nombre+ " - Cumplimiento de Requisitos"):"Cumplimiento de Requisitos";
            document.getElementById("TituloDetalle").innerHTML=norma.Alias!=="Decreto"? (norma.Nombre+ " - Cumplimiento de Requisitos"):"Cumplimiento de Requisitos";
            document.getElementById("Claves").innerHTML= htmlClaves;		
            document.getElementById("IndiceRequisitos").innerHTML= htmlIndiceRequisitos;		
            document.getElementById("Cumplimiento").innerHTML= htmlCumplimiento;
            document.getElementById("Nota").innerHTML=norma.Anotacion||'';
		}
		var getNormaByAlias= function(normas, alias, arrayUtil){
			var _normas= arrayUtil.filter(normas, function(item){
				return item.Alias===alias;
			});
			_normas= _normas||[{Grupos:[]}];
			return  _normas[0];
		}
	</script>
    <script>
    // <![CDATA[
    	var data = ${Dto};

        require(["dojo/_base/lang","dojox/charting/Chart", "dojox/charting/axis2d/Default", "dojox/charting/plot2d/Spider",
        "dojox/charting/themes/PlotKit/blue", "dojo/_base/array",  "dojo/ready"],
        function(lang, Chart, Default, Spider, PlotKit,  arrayUtil, ready){
        ready(function(){  
			
			document.getElementById("Empresa.Nombre").innerHTML= data.Empresa.Nombre;

			var htmlIndice="";
			var data1={};
			var data2={};
			arrayUtil.forEach(data.Capitulos, function(capitulo,i){
				
				var estado= capitulo.TotalR>=capitulo.TotalQ?"green":"red";
                htmlIndice += lang.replace("<tr><td>{capitulo.Numeral}  {capitulo.Titulo}</td><td><button fab {estado}>{capitulo.TotalR}/{capitulo.TotalQ}</button></td></tr>",
                {
                	capitulo:capitulo,
                	estado:estado
                });
				data1[capitulo.Titulo]= 100;
				data2[capitulo.Titulo]= (capitulo.TotalR/capitulo.TotalQ)*100;
            });
            document.getElementById("Indice").innerHTML= htmlIndice;
                        
			var chart = new Chart("spider");                                                                                                
			chart.setTheme(dojox.charting.themes.PlotKit.blue);
			chart.theme.plotarea.fill = null;
			chart.theme.chart.fill = null;
			chart.addPlot("default", {
				type: "Spider",
				labelOffset: -10,
				divisions: 10,
				axisColor:      "lightgray",
				fill: null,
				spiderColor:    "silver",
				seriesFillAlpha: 0.5,
				spiderOrigin:	 0.16,
				markerSize:  	 3,
				precision:		 0,
				spiderType:	 	 "polygon"
			});

			for ( var i in data1){
				chart.addAxis(i, {  min:0, max:data1[i]});
			}
			chart.addSeries("Alcanzado", {data: data2}, { fill: "green" });
			chart.addSeries("Meta", {data: data1}, { fill: "white" });
			chart.render();
			//new Legend({chart: chart, horizontal: true}, "legend1");

			var norma= getNormaByAlias(data.Normas, data.Norma, arrayUtil)

			mostrarNorma(data, norma, arrayUtil, lang);

			var body = document.querySelector("body");
            body.setAttribute("_ready", '');

            var sl = document.getElementById("NormaSelect");
            for (var i in data.Normas){
            	var o = document.createElement('option');
            	o.selected= data.Normas[i].Alias===data.Norma;
            	o.value= data.Normas[i].Alias;
            	o.innerHTML= data.Normas[i].Nombre;
            	sl.options.add(o);
            }
            sl.onchange=function(evt){
            	norma =getNormaByAlias(data.Normas, evt.target.value, arrayUtil)
            	mostrarNorma(data, norma, arrayUtil, lang);
            };

        });
        });
    // ]]>
    </script>
</body>
</html>

