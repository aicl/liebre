<link rel="import" href="../common/q-base.html">
<link rel="import" href="../common/q-ciudades.html">
<link rel="import" href="../common/q-riesgos.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<polymer-element name="q-centros" extends="q-base">
<template>
	<style>
		:host{
			/*height: 100vh;*/
		}
		
		.seleccionados{
			/*height: 100vh;*/
			background: rgb(212,212,212);
			border-radius: 4px;
			overflow: auto;
		}
		.item-s{
			background: white;
			border-radius: 4px;
			margin-bottom: 10px;
			padding: 10px;
			overflow: auto;
		}
		paper-input{
			padding-left:42px;
		}
		
		
	</style>
 <shadow></shadow>
	
	<core-icon-button icon="add-circle"  on-tap="{{ handlerAddItem }}"></core-icon-button>	
	<div  class="seleccionados" disabled?="{{rb.checked || estado!='red'}}" >	
		<template repeat="{{item, index in value}}">
			<div  class="item-s">
				<paper-input  placeholder="Nombre" value="{{item.Nombre}}"></paper-input>
				<q-ciudades selected="{{item.Ciudad}}"></q-ciudades>
				<div layout horizontal center>
					<core-icon-button icon="add-circle" on-tap="{{handlerAddRiesgo}}"></core-icon-button>
					<div>Riesgos</div>
				</div>
				<template repeat="{{riesgo, ri in item.Riesgos}}">
					<q-riesgos selected="{{riesgo}}" 
							   on-riesgo-select="{{handlerRiesgoSelect}}"></q-riesgos>
				</template>
			</div>
		</template>
	</div>
	
	
</template>
	<script>
		Polymer({
			handlerAddItem:function(){
				
			},
			handlerRiesgoSelect:function(event,detail, sender){
				this._current.Riesgos[sender.templateInstance.model.ri]=sender.templateInstance.model.riesgo;
				this.valueChanged();
			},
						
			handlerAddRiesgo:function(event, detail, sender){				
				this._current= sender.templateInstance.model.item;
				this._current.Riesgos.unshift({});
				this.valueChanged();
			},
			ready:function(){		
			},
			domReady:function(){
				this.fire("element-ready");
			},
			go:function(){
				if(!this.value){
					this.value=[];
					this.value.unshift({Nombre:null,Ciudad:null,Riesgos:[{}]});
				}
			},
			valueChanged:function(){
				console.log("q-centros valueChanged", this.value);
				if( this.respuesta) this.respuesta.Valor=this.value;
			}
		})
	</script>
</polymer-element>
